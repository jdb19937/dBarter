
<html>
<head>
<title>The Barter Command Set</title>
</head>

<body bgcolor=#ffffff>
<h3>The Barter Command Set</h3>

<hr>
<h4><code>help</code></h4>

<p>
Prints out a list of all command names.
</p>

<hr>
<h4><code>exit</code></h4>

Says goodbye to the server.  The connection will be terminated with
a CODE_GOODBYE.

<hr>
<h4><code>shutdown</code></h4>

<p>
Tells the server to shutdown.  (User must have USER_FLAG_SUPER.)  All
connections will be terminated with CODE_GOODBYE.
</p>

<hr>
<h4><code>login</code> <i>user</i></h4>

<p>
Initiates authentication as <i>user</i>.  Response will be a challenge
to the user's RSA key.
</p>

<hr>
<h4><code>respond</code> <i>response</i></h4>

<p>
Completes authentication.  <i>response</i> is computed by signing
the challenge generated by the <code>login</code> command.
</p>

<hr>
<h4><code>txn_create</code></h4>

<p>
Begins a transaction.  All commands after <code>txn_create</code> and
before <code>txn_commit</code> or <code>txn_abort</code> will be
treated as a transaction.  While in a transaction, CODE_ERR_ABORTED
can be returned as an error by any command due to a lock conflict.
If this happens, you will need to begin a new transaction and start
over.  (Requires USER_FLAG_TXN.)
</p>

<hr>
<h4><code>txn_commit</code></h4>

<p>
Commits a transaction.  (Requires USER_FLAG_TXN.)
</p>

<hr>
<h4><code>txn_abort</code></h4>

<p>
Aborts a transaction.  (Requires USER_FLAG_TXN.)
</p>

<hr>
<h4><code>event_read</code> <i>event</i></h4>

<p>
Prints out attributes of the event <i>event</i>.  User must have permission
to read this event.
</p>

<hr>
<h4><code>event_list</code> [<i>lower-bound</i> [<i>upper-bound</i>]]</h4>

<p>
Prints out a list of all events in between <i>lower-bound</i> and
<i>upper-bound</i> which the user has permission to read.  <i>lower-bound</i>
defaults to 1 and <i>upper-bound</i> defaults to the the maximum event
in the system.
</p>

<hr>
<h4><code>event_last</code></h4>

<p>
Prints out the identity of the last event in the system.
</p>

<hr>
<h4><code>event_send</code> <i>recipient</i> <i>message</i></h4>

<p>
Creates a pair of events, one with type "event_sent" (which you have
access to) and the other with type "event_received" (which <i>recipient</i>
has access to).  The extra attributes of the event will be <i>from</i>
(which is set to your user), <i>to</i> (which is set to <i>recipient</i>),
and <i>message</i> (which is set to <i>message</i>, any string,
conventionally CGI-escaped).
</p>

<hr>
<h4><code>user_create</code> <i>user</i> <i>public</i> <i>modulus</i></h4>
<p>
Creates a new user with the given public key and modulus.
(Requires USER_FLAG_SUPER.)
</p>

<hr>
<h4><code>user_set</code> <i>user</i> <i>attribute</i> <i>value</i></h4>
<p>
Sets an <i>attribute</i> of <i>user</i> to the given <i>value</i>.
</p>

<hr>
<h4><code>user_read</code> <i>user</i></h4>
<p>
Prints out attributes of <i>user</i> which you have permission to read.
</p>

<hr>
<h4><code>user_destroy</code> <i>user</i></h4>
<p>
Removes a user from the system.  (Requires USER_FLAG_SUPER.)
</p>

<hr>
<h4><code>denom_create</code> <i>denom</i></h4>
<p>
Creates a new denomination.
(Requires USER_FLAG_ISSUER.)
</p>

<hr>
<h4><code>denom_set</code> <i>denom</i> <i>attribute</i> <i>value</i></h4>
<p>
Sets an <i>attribute</i> of <i>denom</i> to the given <i>value</i>.
</p>

<hr>
<h4><code>denom_read</code> <i>denom</i></h4>
<p>
Prints out attributes of <i>denom</i> which you have permission to read.
</p>

<hr>
<h4><code>denom_destroy</code> <i>denom</i></h4>
<p>
Removes a denomination from the system.  (Requires USER_FLAG_ISSUER.)
</p>

<hr>
<h4><code>denom_list</code></h4>
<p>
Lists all denominations for which you are the issuer.
</p>

<hr>
<h4><code>denom_list_all</code></h4>
<p>
Lists all denominations that exist on the system.
</p>

<hr>
<h4><code>note_read</code> <i>note</i> [<i>signature</i>]</h4>
<p>
Prints out attributes of <i>note</i> which you have permission to read.
<i>signature</i> is required if you are not the issuer of <i>note</i>.
</p>

<hr>
<h4><code>note_list</code></h4>
<p>
Lists all notes for which you are the issuer.
</p>

<hr>
<h4><code>note_withdraw</code> <i>value</i> ...</h4>
<p>
Debits all <i>value</i>s from your account and creates a new note containing
the <i>value</i>s as its portfolio.  The identity of the note is returned.
</p>

<hr>
<h4><code>note_deposit</code> <i>note</i> <i>signature</i></h4>
<p>
Deposits <i>note</i> into your account and destroys it.  The list of
deposited values is returned.
</p>

<hr>
<h4><code>balance</code></h4>
<p>
Prints out a list of all values in your account (your portfolio).
</p>

<hr>
<h4><code>credit</code> <i>recipient</i> <i>value</i></h4>
<p>
Adds <i>value</i> to <i>recipient</i>'s portfolio.
(Requires USER_FLAG_SUPER, or USER_FLAG_ISSUER if user is issuer
of <i>value</i>'s denomination.)
</p>

<hr>
<h4><code>credit</code> <i>recipient</i> <i>value</i></h4>
<p>
Subtracts <i>value</i> from <i>recipient</i>'s portfolio.
(Requires USER_FLAG_SUPER, or USER_FLAG_ISSUER if user is issuer
of <i>value</i>'s denomination.)
</p>

</body>
</html>
